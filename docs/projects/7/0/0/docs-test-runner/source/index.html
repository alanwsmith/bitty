<pre class="code-block"><code><span class="line-marker"></span><span class="source js"><span class="meta export js"><span class="keyword control import-export js">export</span> <span class="variable other readwrite js">class</span> </span><span class="variable other readwrite js">BittyDocTestRunner</span> <span class="meta block js"><span class="punctuation section block js">{</span>
<span class="line-marker"></span>  <span class="variable other readwrite js">async</span> <span class="meta function-call js"><span class="variable function js">testResults</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="variable other readwrite js">_</span><span class="punctuation separator comma js">,</span> <span class="variable other readwrite js">el</span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span> <span class="meta block js"><span class="punctuation section block js">{</span>
<span class="line-marker"></span>    <span class="keyword control flow js">await</span> <span class="variable language this js">this</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">sleep</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="constant numeric js">1000</span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>    <span class="storage type js">let</span> <span class="variable other readwrite js">testCount</span> <span class="keyword operator assignment js">=</span> <span class="constant numeric js">0</span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>    <span class="storage type js">let</span> <span class="variable other readwrite js">failed</span> <span class="keyword operator assignment js">=</span> <span class="constant numeric js">0</span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>    <span class="storage type js">let</span> <span class="variable other readwrite js">bugs</span> <span class="keyword operator assignment js">=</span> <span class="constant numeric js">0</span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>
<span class="line-marker"></span>    <span class="support type object dom js">document</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">querySelectorAll</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>[data-bug]<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">forEach</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="meta function declaration js"><span class="punctuation section group begin js">(</span><span class="variable parameter function js">el</span><span class="punctuation section group end js">)</span><span class="meta function declaration js"> </span><span class="storage type function arrow js">=&gt;</span></span> <span class="meta block js"><span class="punctuation section block js">{</span>
<span class="line-marker"></span>      <span class="variable other readwrite js">testCount</span> <span class="keyword operator assignment augmented js">+=</span> <span class="constant numeric js">1</span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      <span class="variable other readwrite js">bugs</span> <span class="keyword operator assignment augmented js">+=</span> <span class="constant numeric js">1</span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      <span class="storage type js">const</span> <span class="variable other readwrite js">summary</span> <span class="keyword operator assignment js">=</span> <span class="variable other object js">el</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">closest</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>details<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">querySelector</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>summary<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      <span class="storage type js">const</span> <span class="variable other readwrite js">parentSummary</span> <span class="keyword operator assignment js">=</span> <span class="variable other object js">summary</span><span class="punctuation accessor js">.</span><span class="meta property object js">parentNode</span><span class="punctuation accessor js">.</span><span class="meta property object js">parentNode</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">closest</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>details<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span>
<span class="line-marker"></span>        <span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">querySelector</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>summary<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      <span class="variable other object js">summary</span><span class="punctuation accessor js">.</span><span class="meta property object js">dataset</span><span class="punctuation accessor js">.</span><span class="meta property object js">status</span> <span class="keyword operator assignment js">=</span> <span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>bug<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      <span class="variable other object js">parentSummary</span><span class="punctuation accessor js">.</span><span class="meta property object js">dataset</span><span class="punctuation accessor js">.</span><span class="meta property object js">status</span> <span class="keyword operator assignment js">=</span> <span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>bug<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      <span class="variable other object js">el</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="support function dom js">appendChild</span><span class="meta group js"><span class="punctuation section group js">(</span>
<span class="line-marker"></span>        <span class="variable language this js">this</span><span class="punctuation accessor js">.</span><span class="meta property object js">api</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">makeElement</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="variable language this js">this</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">template</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>bug<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation separator comma js">,</span> <span class="meta sequence js"><span class="punctuation section brackets js">[</span><span class="meta sequence js"><span class="punctuation section brackets js">[</span>
<span class="line-marker"></span>          <span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>BUG<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation separator comma js">,</span> <span class="variable other object js">el</span><span class="punctuation accessor js">.</span><span class="meta property object js">dataset</span><span class="punctuation accessor js">.</span><span class="meta property object js">bug</span>
<span class="line-marker"></span>        <span class="punctuation section brackets js">]</span></span><span class="punctuation section brackets js">]</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span>
<span class="line-marker"></span>      </span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>    <span class="punctuation section block js">}</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>
<span class="line-marker"></span>    <span class="support type object dom js">document</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">querySelectorAll</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>[data-expected]<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">forEach</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="meta function declaration js"><span class="punctuation section group begin js">(</span><span class="variable parameter function js">el</span><span class="punctuation section group end js">)</span><span class="meta function declaration js"> </span><span class="storage type function arrow js">=&gt;</span></span> <span class="meta block js"><span class="punctuation section block js">{</span>
<span class="line-marker"></span>      <span class="storage type js">const</span> <span class="variable other readwrite js">summary</span> <span class="keyword operator assignment js">=</span> <span class="variable other object js">el</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">closest</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>details<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">querySelector</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>summary<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      <span class="storage type js">const</span> <span class="variable other readwrite js">parentSummary</span> <span class="keyword operator assignment js">=</span> <span class="variable other object js">summary</span><span class="punctuation accessor js">.</span><span class="meta property object js">parentNode</span><span class="punctuation accessor js">.</span><span class="meta property object js">parentNode</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">closest</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>details<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span>
<span class="line-marker"></span>        <span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">querySelector</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>summary<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      <span class="variable other readwrite js">testCount</span> <span class="keyword operator assignment augmented js">+=</span> <span class="constant numeric js">1</span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      <span class="meta conditional js"><span class="keyword control conditional js">if</span> <span class="meta group js"><span class="punctuation section group js">(</span><span class="variable other object js">el</span><span class="punctuation accessor js">.</span><span class="meta property object js">dataset</span><span class="punctuation accessor js">.</span><span class="meta property object js">expected</span> <span class="keyword operator comparison js">===</span> <span class="variable other object js">el</span><span class="punctuation accessor js">.</span><span class="meta property object js">innerHTML</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">trim</span><span class="meta group js"><span class="punctuation section group js">(</span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation section group js">)</span></span> <span class="meta block js"><span class="punctuation section block js">{</span>
<span class="line-marker"></span>        <span class="variable other object js">summary</span><span class="punctuation accessor js">.</span><span class="meta property object js">dataset</span><span class="punctuation accessor js">.</span><span class="meta property object js">status</span> <span class="keyword operator assignment js">=</span> <span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>passed<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>        <span class="meta conditional js"><span class="keyword control conditional js">if</span> <span class="meta group js"><span class="punctuation section group js">(</span>
<span class="line-marker"></span>          <span class="variable other object js">parentSummary</span><span class="punctuation accessor js">.</span><span class="meta property object js">dataset</span><span class="punctuation accessor js">.</span><span class="meta property object js">status</span> <span class="keyword operator comparison js">!==</span> <span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>failed<span class="punctuation definition string end js">&quot;</span></span>
<span class="line-marker"></span>          <span class="keyword operator logical js">&amp;&amp;</span>
<span class="line-marker"></span>          <span class="variable other object js">parentSummary</span><span class="punctuation accessor js">.</span><span class="meta property object js">dataset</span><span class="punctuation accessor js">.</span><span class="meta property object js">status</span> <span class="keyword operator comparison js">!==</span> <span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>bug<span class="punctuation definition string end js">&quot;</span></span>
<span class="line-marker"></span>        <span class="punctuation section group js">)</span></span> <span class="meta block js"><span class="punctuation section block js">{</span>
<span class="line-marker"></span>          <span class="variable other object js">parentSummary</span><span class="punctuation accessor js">.</span><span class="meta property object js">dataset</span><span class="punctuation accessor js">.</span><span class="meta property object js">status</span> <span class="keyword operator assignment js">=</span> <span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>passed<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>        </span><span class="meta block js"><span class="punctuation section block js">}</span></span></span>
<span class="line-marker"></span>      </span><span class="meta block js"><span class="punctuation section block js">}</span></span></span> <span class="meta conditional js"><span class="keyword control conditional js">else</span> <span class="meta block js"><span class="punctuation section block js">{</span>
<span class="line-marker"></span>        <span class="variable other readwrite js">failed</span> <span class="keyword operator assignment augmented js">+=</span> <span class="constant numeric js">1</span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>        <span class="variable other object js">summary</span><span class="punctuation accessor js">.</span><span class="meta property object js">dataset</span><span class="punctuation accessor js">.</span><span class="meta property object js">status</span> <span class="keyword operator assignment js">=</span> <span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>failed<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>        <span class="variable other object js">parentSummary</span><span class="punctuation accessor js">.</span><span class="meta property object js">dataset</span><span class="punctuation accessor js">.</span><span class="meta property object js">status</span> <span class="keyword operator assignment js">=</span> <span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>failed<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      </span><span class="meta block js"><span class="punctuation section block js">}</span></span></span>
<span class="line-marker"></span>    <span class="punctuation section block js">}</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>    <span class="storage type js">const</span> <span class="variable other readwrite js">subs</span> <span class="keyword operator assignment js">=</span> <span class="meta sequence js"><span class="punctuation section brackets js">[</span>
<span class="line-marker"></span>      <span class="meta sequence js"><span class="punctuation section brackets js">[</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>TOTAL<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation separator comma js">,</span> <span class="variable other readwrite js">testCount</span><span class="punctuation section brackets js">]</span></span><span class="punctuation separator comma js">,</span>
<span class="line-marker"></span>      <span class="meta sequence js"><span class="punctuation section brackets js">[</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>PASSED<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation separator comma js">,</span> <span class="variable other readwrite js">testCount</span> <span class="keyword operator arithmetic js">-</span> <span class="variable other readwrite js">failed</span><span class="punctuation section brackets js">]</span></span><span class="punctuation separator comma js">,</span>
<span class="line-marker"></span>      <span class="meta sequence js"><span class="punctuation section brackets js">[</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>FAILED<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation separator comma js">,</span> <span class="variable other readwrite js">failed</span><span class="punctuation section brackets js">]</span></span><span class="punctuation separator comma js">,</span>
<span class="line-marker"></span>      <span class="meta sequence js"><span class="punctuation section brackets js">[</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>BUGS<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation separator comma js">,</span> <span class="variable other readwrite js">bugs</span><span class="punctuation section brackets js">]</span></span><span class="punctuation separator comma js">,</span>
<span class="line-marker"></span>
<span class="line-marker"></span>    <span class="punctuation section brackets js">]</span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>    <span class="variable other object js">el</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">replaceChildren</span><span class="meta group js"><span class="punctuation section group js">(</span>
<span class="line-marker"></span>      <span class="variable language this js">this</span><span class="punctuation accessor js">.</span><span class="meta property object js">api</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">makeHTML</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="variable language this js">this</span><span class="punctuation accessor js">.</span><span class="meta function-call method js"><span class="variable function js">template</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>results<span class="punctuation definition string end js">&quot;</span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation separator comma js">,</span> <span class="variable other readwrite js">subs</span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation separator comma js">,</span>
<span class="line-marker"></span>    </span><span class="meta group js"><span class="punctuation section group js">)</span></span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>  <span class="punctuation section block js">}</span></span>
<span class="line-marker"></span>
<span class="line-marker"></span>  <span class="meta function-call js"><span class="variable function js">sleep</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="variable other readwrite js">ms</span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span> <span class="meta block js"><span class="punctuation section block js">{</span>
<span class="line-marker"></span>    <span class="keyword control flow js">return</span> <span class="meta instance constructor js"><span class="keyword operator word new js">new</span><span class="meta function-call constructor js"> <span class="support class builtin js">Promise</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="meta function declaration js"><span class="punctuation section group begin js">(</span><span class="variable parameter function js">resolve</span><span class="punctuation section group end js">)</span><span class="meta function declaration js"> </span><span class="storage type function arrow js">=&gt;</span></span> <span class="meta block js"><span class="meta function-call js"><span class="support function js">setTimeout</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="variable other readwrite js">resolve</span><span class="punctuation separator comma js">,</span> <span class="variable other readwrite js">ms</span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span></span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>  <span class="punctuation section block js">}</span></span>
<span class="line-marker"></span>
<span class="line-marker"></span>  <span class="meta function-call js"><span class="variable function js">template</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="variable other readwrite js">template</span></span><span class="meta group js"><span class="punctuation section group js">)</span></span></span> <span class="meta block js"><span class="punctuation section block js">{</span>
<span class="line-marker"></span>    <span class="meta switch js"><span class="keyword control switch js">switch</span> <span class="meta group js"><span class="punctuation section group js">(</span><span class="variable other readwrite js">template</span><span class="punctuation section group js">)</span></span> <span class="meta block js"><span class="punctuation section block js">{</span>
<span class="line-marker"></span>      <span class="keyword control switch js">case</span> <span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>results<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation section group js">)</span></span><span class="punctuation separator js">:</span>
<span class="line-marker"></span>        <span class="keyword control flow js">return</span> <span class="string template js"><span class="punctuation definition string template begin js">`</span>&lt;h4&gt;Test Results&lt;/h4&gt;
<span class="line-marker"></span>&lt;div&gt;Total Test: TOTAL ~ 
<span class="line-marker"></span>&lt;span&gt;Passed: PASSED&lt;/span&gt; ~
<span class="line-marker"></span>&lt;span&gt;Failed: FAILED&lt;/span&gt; ~
<span class="line-marker"></span>&lt;span&gt;Bugs: BUGS&lt;/span&gt;&lt;/div&gt;<span class="punctuation definition string template end js">`</span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>        <span class="keyword control loop js">break</span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>      <span class="keyword control switch js">case</span><span class="meta group js"><span class="punctuation section group js">(</span><span class="string quoted double js"><span class="punctuation definition string begin js">&quot;</span>bug<span class="punctuation definition string end js">&quot;</span></span><span class="punctuation section group js">)</span></span><span class="punctuation separator js">:</span>
<span class="line-marker"></span>        <span class="keyword control flow js">return</span> <span class="string template js"><span class="punctuation definition string template begin js">`</span> &lt;span class=&quot;docs-bug&quot;&gt; BUG&lt;/span&gt;<span class="punctuation definition string template end js">`</span></span><span class="punctuation terminator statement js">;</span>
<span class="line-marker"></span>    </span><span class="meta block js"><span class="punctuation section block js">}</span></span></span>
<span class="line-marker"></span>  <span class="punctuation section block js">}</span></span>
<span class="line-marker"></span><span class="punctuation section block js">}</span></span></span></code></pre>